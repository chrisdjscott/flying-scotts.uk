{% extends "layout.html" %}

{% block head %}
    {{ super() }}

    <!-- Leaflet CSS and JavaScript -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.3.1/gpx.min.js" type="text/javascript"></script>

    <!-- Custom map CSS -->
    <link href="{{ '/static/css/map.min.css'|asseturl }}" rel="stylesheet">
{% endblock head %}

{% block background %}{{ this.background|url }}{% endblock %}

{% block content %}
    <article>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-md-10 mx-auto">
                    {{ this.body }}
                </div>
            </div>
        </div>
        {% if not this.gpx and this.latitude and this.longitude %}
            <div class="container">
                <div id="map" style="height: 500px;"></div>
            </div>
        {% endif %}
    </article>

    {% if this.gpx %}
        <!-- Map of the route -->
        <section id="post-route" class="gpx" data-gpx-source="{{ this.gpx|url }}" data-map-target="post-map">
            <header>
                <h3>Loading...</h3>
                <span class="start"></span>
            </header>

            <article>
                <div class="map" id="post-map"></div>
            </article>

            <footer>
                <ul class="info">
                    <li>Distance:&nbsp;<span class="distance"></span>&nbsp;km</li>
                    &mdash; <li>Elapsed:&nbsp;<span class="elapsed"></span></li>
                    &mdash; <li>Moving:&nbsp;<span class="moving"></span></li>
                    &mdash; <li>Pace:&nbsp;<span class="pace"></span>/km</li>
                    &mdash; <li>Ascent:&nbsp;<span class="ascent"></span>&nbsp;m</li>
                </ul>
            </footer>
        </section>
    {% endif %}
{% endblock content %}

{% block bottom %}
    {{ super() }}

    <script src="{{ '/static/js/map.min.js'|asseturl }}" type="text/javascript"></script>
    {% if this.gpx %}
        <script type="text/javascript">
            display_gpx("{{ '/static'|url }}", "{{ this.title }}", document.getElementById("post-route"));
        </script>
    {% elif this.latitude and this.longitude %}
        <script type="text/javascript">
            initmap({{ this.latitude }}, {{ this.longitude }}, {{ this.zoom }});
            addMarker("{{ this.title }}", "{{ this|url }}", "{{ this.date|dateformat('d MMMM y') }}", {{ this.latitude }}, {{ this.longitude }});
        </script>
    {% endif %}
{% endblock bottom %}
